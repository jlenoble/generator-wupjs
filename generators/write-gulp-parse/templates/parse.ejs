import gulp from 'gulp';
import antlr4 from 'gulp-antlr4';

const grammarGlob = <%- grammarGlob %>;
const parserDir = '<%- parserDir %>';
const dataGlob = <%- dataGlob %>;
const grammar = '<%- grammar %>';
const listener = '<%- listener %>';
const listenerDir = '<%- listenerDir %>';
const rule = '<%- rule %>';

export const makeParser = () => {
  return gulp.src(grammarGlob, {
    since: gulp.lastRun(makeParser),
  })
    .pipe(antlr4(parserDir));
};

export const parse = () => {
  return gulp.src(dataGlob, {
    since: gulp.lastRun(parse),
  })
    .pipe(antlr4({
      grammar, parserDir, listener, listenerDir, rule,
    }));
};

gulp.task('parse', gulp.series(makeParser, parse));
