import gulp from 'gulp';
import path from 'path';
import browserSync from 'browser-sync';

import './bundle';<%- importSass %>

const buildDir = '<%- buildDir %>';
const staticDir = '<%- dirs('staticDir') %>';
const nodeDir = '<%- dirs('nodeDir') %>';
const bsWatchGlob = <%- bsWatchGlob %>;

export const serve = done => {
  var bs = browserSync.create('server');

  bs.init({
    ui: false,
    port: 3000,
    server: {
      baseDir: [buildDir, staticDir, nodeDir],
    },
  }, done);

  gulp.watch(bsWatchGlob).on('change', (...args) => {
      bs.reload(...args);
    });
};

gulp.task('serve', gulp.series(<%- preServeTask %>, serve));
