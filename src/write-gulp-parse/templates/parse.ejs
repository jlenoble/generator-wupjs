import gulp from 'gulp';
import antlr4 from 'gulp-antlr4';

<%- consts %>
export const makeParser = () => {
  if (require && require.cache) {
    // Remove parser files from Babel cache
    Object.keys(require.cache).filter(key => {
      return key.includes(parserDir) ||
        key.includes(listenerDir) ||
        key.includes(visitorDir);
    }).forEach(key => {
      delete require.cache[key];
    });
  }

  return gulp.src(grammarGlob)
    .pipe(antlr4(<%- makeParserOptions %>));
};
<%- parseTasks %>
